# LocalInsightEngine üöÄ

**Intelligente, urheberrechtskonforme Analyse von Sachb√ºchern und Dokumenten**

![Work in Progress](https://img.shields.io/badge/Status-Production%20Ready%20v0.1.1-green)
![MIT License](https://img.shields.io/badge/License-MIT-green)
![Python](https://img.shields.io/badge/Python-3.8%2B-blue)
[![Developed with Claude Code](https://img.shields.io/badge/Developed%20with-Claude%20Code-purple)](https://claude.ai/code)

Eine vollst√§ndig funktionsf√§hige Python-Anwendung zur Analyse von PDF-Dokumenten mit Hilfe gro√üer Sprachmodelle, ohne dabei urheberrechtlich gesch√ºtzte Inhalte zu √ºbertragen.

## ‚ú® Features

- **üìñ Sachbuch-Modus**: Bypass f√ºr faktische Inhalte - keine Anonymisierung wissenschaftlicher Begriffe
- **üîí Urheberrechtskonform**: Niemals Originaltext an externe APIs (au√üer im bewusst gew√§hlten Sachbuch-Modus)
- **üèóÔ∏è 3-Layer-Architektur**: Saubere Trennung von Datenverarbeitung und Analyse
- **üá©üá™ Deutsche & Englische NLP**: spaCy-basierte Named Entity Recognition
- **ü§ñ Claude-4 Integration**: Modernste KI-Analyse mit intelligenten Insights
- **üìÅ Multi-Format Support**: PDF, TXT, EPUB, DOCX mit automatischer Erkennung
- **üîç File-Type Validation**: Erkennt echten Dateityp unabh√§ngig von Extension
- **üìä Vollst√§ndige Nachverfolgbarkeit**: Jede Erkenntnis zur√ºck zur Quelle verfolgbar
- **üß™ Umfassende Tests**: Unit-, Integration- und Multi-Language Tests
- **‚ö° Produktionsreif**: Moderne Python-Architektur mit Code Quality

### üÜï Neue Enterprise-Features (v0.1.1)

- **üîç FTS5 Semantic Search**: SQLite-basierte Volltext-Suche mit BM25-Ranking f√ºr intelligente Q&A
- **üóÑÔ∏è Persistent Q&A Sessions**: Automatische SQLite-Persistierung aller Analyse-Sessions
- **üìä Enhanced Debug Logging**: Comprehensive Performance-Tracking und detaillierte Analyse-Logs
- **‚öôÔ∏è Konfigurationsdatei**: `localinsightengine.conf` f√ºr alle System-Einstellungen
- **üöÄ Database Auto-Creation**: Automatische SQLite-DB-Erstellung mit WAL-Mode und FTS5-Support
- **üéØ Smart Q&A System**: Multi-Layer Search (FTS5 ‚Üí Keyword ‚Üí Fallback) mit Context-Awareness
- **üìà Performance Monitoring**: Detaillierte Metriken f√ºr Document Loading, Processing und LLM Analysis
- **üîÑ Robust Fallback Systems**: Graceful Degradation bei Database/FTS5-Fehlern

## üèõÔ∏è Architektur

### Layer 1: Daten-Layer (`data_layer`)
- **PDF/EPUB/DOCX Parser** mit pr√§zisem Seiten- und Absatz-Mapping
- **Unterst√ºtzte Formate**: PDF, TXT, EPUB, Word-Dokumente
- **Metadaten-Extraktion**: Autor, Titel, Seitenanzahl, etc.

### Layer 2: Verarbeitungs-Layer (`processing_hub`)  
- **spaCy NER**: Hochpr√§zise Entit√§tenerkennung f√ºr Deutsch & Englisch
- **Statement-Extraktor**: Neutralisierung von Kernaussagen
- **Text-Chunking**: Intelligente Aufteilung mit √úberlappung
- **Copyright-Compliance**: Vollst√§ndige Neutralisierung vor externer √úbertragung

### Layer 3: Analyse-Layer (`analysis_engine`)
- **Claude-4 API Integration**: Modernste KI-Analyse mit intelligenten Insights
- **Robuste JSON-Parsing**: Automatische Fallback-Mechanismen
- **Strukturierte Outputs**: Erkenntnisse, Fragen, Zusammenfassungen
- **Mock-Modus**: Funktioniert auch ohne API-Key f√ºr Tests

### üÜï Persistence Layer (`persistence`)
- **SQLite Database**: Automatische Erstellung mit WAL-Mode f√ºr Concurrency
- **FTS5 Full-Text Search**: BM25-Ranking mit Time-Decay f√ºr semantische Suche
- **Q&A Session Management**: Vollst√§ndige Persistierung aller Analyse-Sessions
- **Smart Search Engine**: Cross-Session Knowledge Discovery und Related Insights
- **Repository Pattern**: High-Level CRUD Operations mit Business Logic

### üÜï Enhanced Logging (`utils`)
- **Debug Logger**: Performance-Tracking und detaillierte System-Metriken
- **Konfigurable Log-Pfade**: Projektverzeichnis oder tempor√§rer Ordner
- **Log Rotation**: 50MB max, 5 Backup-Dateien mit automatischer Cleanup
- **Dependency Validation**: Automatische Checks aller kritischen Komponenten

## üöÄ Installation

### 1. Repository klonen
```bash
git clone https://github.com/ddumdi11/LocalInsightEngine.git
cd LocalInsightEngine
```

### 2. Virtual Environment erstellen
```bash
# Python 3.8+ erforderlich (au√üerhalb venv)
py -m venv .venv

# Windows
.venv\Scripts\activate

# Linux/Mac  
source .venv/bin/activate
```

### 3. Dependencies installieren
```bash
# Alle Abh√§ngigkeiten installieren (innerhalb aktivierter venv)
python -m pip install -r requirements-dev.txt

# SpaCy-Modelle herunterladen
python -m spacy download de_core_news_sm  # Deutsch
python -m spacy download en_core_web_sm   # Englisch (optional)
```

### 4. (Optional) Claude API-Key setzen
```bash
# F√ºr echte KI-Analyse
export LLM_API_KEY="your-claude-api-key"

# Oder in .env Datei:
echo "LLM_API_KEY=your-claude-api-key" > .env
```

## üìñ Sachbuch-Modus (Neu!)

**F√ºr wissenschaftliche und faktische Inhalte** - Der Sachbuch-Modus erm√∂glicht die vollst√§ndige Analyse von Sachb√ºchern ohne Anonymisierung g√§ngiger Begriffe.

### üîÑ Funktionsweise

**Vor der Analyse:**
```
‚òê Sachbuch-Modus (keine Anonymisierung g√§ngiger Begriffe) [AKTIV]
[Analyze Document] Button
```

**Nach Analyse im Standard-Modus:**
```
‚òê Standard-Modus aktiv [AUSGEGRAUT]
[üîÑ Neu analysieren im Sachbuch-Modus] Button
```

**Nach Analyse im Sachbuch-Modus:**
```
‚òë Sachbuch-Modus aktiv [AUSGEGRAUT]
[üîÑ Neu analysieren im Standard-Modus] Button
```

### üéØ Vorteile des Sachbuch-Modus

- ‚úÖ **Pr√§zise Vitamin-Analysen**: "Vitamin B3" bleibt erhalten statt neutralisiert
- ‚úÖ **Wissenschaftliche Begriffe**: Niacin, Magnesium, Fols√§ure werden nicht anonymisiert
- ‚úÖ **A/B Testing**: Direkter Vergleich beider Modi in der GUI
- ‚úÖ **User-Kontrolle**: Bewusste Entscheidung pro Dokument
- ‚úÖ **Rechtssicherheit**: Standard-Modus bleibt aktiv f√ºr urheberrechtlich gesch√ºtzte Literatur

### ‚öñÔ∏è Rechtliche Einordnung

**Sachbuch-Modus ist sicher f√ºr:**
- Wissenschaftliche Fachbegriffe (Vitamin B3, Calcium, etc.)
- Medizinische Terminologie
- Allgemeine Sachbuch-Inhalte
- Faktische Informationen

**Standard-Modus verwenden f√ºr:**
- Belletristik und kreative Werke
- Pers√∂nliche/private Dokumente
- Unbekannte Urheberrechtssituation

## üéØ Nutzung

### Einfacher Start mit Start.bat (Empfohlen)
```bash
# Dokument analysieren
Start.bat document.pdf

# Version anzeigen
Start.bat --version

# Schnelltest ausf√ºhren
Start.bat --test

# Hilfe anzeigen
Start.bat --help
```

### Direkte CLI-Nutzung (innerhalb aktivierter .venv)
```bash
# Dokument analysieren
python -m local_insight_engine.main document.pdf

# Version anzeigen
python -m local_insight_engine.main --version

# Hilfe anzeigen
python -m local_insight_engine.main --help
```

### Tests & Validierung (innerhalb aktivierter .venv)
```bash
# Multi-Format Test (TXT bevorzugt, PDF Fallback) - EMPFOHLEN
python tests/test_multiformat.py

# Multi-Language Test (Deutsch & Englisch)  
python tests/test_multilanguage.py

# File-Type Detection & Validation
python tests/test_file_detection.py

# Unit Tests f√ºr Core-Komponenten
python tests/test_unit_tests.py

# Claude API Debugging
python tests/test_claude_debug.py

# Legacy PDF-only Test
python tests/test_pdf_processing.py
```

## ‚öôÔ∏è Konfiguration

### localinsightengine.conf (Neu!)

Das System erstellt automatisch eine Konfigurationsdatei `localinsightengine.conf` im Projektverzeichnis mit allen wichtigen Einstellungen:

```ini
[Logging]
# Log-Verzeichnis: 'temp' f√ºr System-Temp oder absoluter Pfad
log_directory = .
log_filename = localinsightengine.log
log_level = DEBUG
console_output = true
max_log_size_mb = 50
backup_count = 5

[Database]
# SQLite-Datenbank-Pfad
database_path = data/qa_sessions.db
auto_create_db = true
enable_fts5 = true

[Analysis]
# Standard-Modus f√ºr Sachbuch-Analyse
default_factual_mode = false
max_qa_chunks = 100
enable_semantic_search = true

[Performance]
# Performance-Logging aktivieren
enable_performance_logging = true
log_chunk_details = true
log_entity_details = true
```

### üìä Enhanced Logging

**Automatische Log-Erstellung:**
- **Log-Datei**: `localinsightengine.log` (konfigurierbar)
- **Performance-Tracking**: Detaillierte Metriken f√ºr alle Operationen
- **Debug-Informationen**: Chunk-Details, Entity-Extraktion, Q&A-Sessions
- **Dependency-Validation**: Automatische Checks aller Komponenten

**Log-Beispiel:**
```
2025-09-18 07:26:28 | INFO | LocalInsightEngine | STEP 1: Initializing LocalInsightEngine
2025-09-18 07:26:28 | INFO | LocalInsightEngine | DATABASE: Database initialized
2025-09-18 07:26:28 | INFO | LocalInsightEngine | ‚úÖ spaCy model de_core_news_sm: Available
2025-09-18 07:26:29 | INFO | LocalInsightEngine | PERF END: document_analysis - Duration: 15.234s
```

### üóÑÔ∏è Persistent Database

**Automatische SQLite-Erstellung:**
- **Datei**: `data/qa_sessions.db` (mit WAL-Mode)
- **FTS5-Support**: Volltext-Suche mit BM25-Ranking
- **Session-Management**: Alle Q&A-Sessions persistent gespeichert
- **Cross-Session Search**: Intelligente Suche √ºber alle Dokumente

### Programmatische Nutzung
```python
from pathlib import Path
from local_insight_engine.main import LocalInsightEngine

# Engine initialisieren (mit automatischer DB-Erstellung)
engine = LocalInsightEngine()

# Dokument im Standard-Modus analysieren
results = engine.analyze_document(Path("your-document.pdf"))

# Dokument im Sachbuch-Modus analysieren
results_factual = engine.analyze_document(Path("scientific-paper.pdf"), factual_mode=True)

# Intelligente Q&A mit FTS5 Semantic Search
answer = engine.answer_question("Was steht im Text zu Vitamin B3?")
print(f"Antwort: {answer}")

# Weitere Q&A-Sessions (nutzen automatisch Semantic Search)
answer2 = engine.answer_question("Welche Nebenwirkungen werden erw√§hnt?")

# Ergebnisse anzeigen
print(f"Status: {results['status']}")
print(f"Erkenntnisse: {len(results.get('insights', []))}")
print(f"Executive Summary: {results.get('executive_summary', 'N/A')}")

# Performance-Logs werden automatisch geschrieben nach:
# localinsightengine.log (im Projektverzeichnis)
```

## üìÅ Projektstruktur

```
LocalInsightEngine/
‚îú‚îÄ‚îÄ src/
tests/
README.md
‚îî‚îÄ‚îÄ README.md
```

## ü§ù Development mit Claude Code

Dieses Projekt wird in Zusammenarbeit mit [Claude Code](https://claude.ai/code) entwickelt - einem KI-gest√ºtzten Entwicklungsassistenten, der bei:

- üîç Code-Analyse und Refactoring
- üìù Dokumentation und README-Erstellung  
- üêõ Debugging und Probleml√∂sung
- üß™ Test-Implementierung
- üìä Repository-Optimierung

unterst√ºtzt hat.

## üìà Roadmap

### ‚úÖ Abgeschlossen (v0.1.1)
- [x] Vollst√§ndige 3-Layer-Architektur
- [x] PDF/EPUB/DOCX-Parser mit pr√§zisem Mapping
- [x] spaCy-Integration (Deutsch + Englisch)
- [x] Claude-4 API-Client mit modernsten Modellen
- [x] Statement-Neutralisierung f√ºr Copyright-Compliance
- [x] Komplette Test-Pipeline mit Unit- und Integrationstests
- [x] **JSON Export-Funktionalit√§t** (CLI, Start.bat, programmatisch)
- [x] **Copyright-Compliance** (‚úÖ All anonymization tests passing)

### üöß Geplant (v0.2.0)
- [x] **Anonymization Issues Fixed** (‚úÖ Intelligent entity neutralization)
- [ ] **Persistent QA System** - Interactive document analysis with session memory
  - [ ] Knowledge graph persistence across sessions
  - [ ] Context-aware question answering
  - [ ] Incremental learning from user interactions
  - [ ] Bookmark and annotation system
- [ ] File-type detection warnings for mismatched extensions
- [ ] CSV/PDF Export-Formate
- [ ] Web-Interface (FastAPI + React)
- [ ] Batch-Processing f√ºr multiple Dokumente

### üîÆ Zukunft (v1.0.0)
- [ ] Graphische Benutzeroberfl√§che
- [ ] Database-Backend f√ºr gro√üe Dokumente
- [ ] Multi-Language Support (erweitert)
- [ ] Collaborative Analysis Features
- [ ] Enterprise-Deployment-Optionen

## ü§î Probleme & L√∂sungen

### Bekannte Issues:
- **Problem**: Kleinere Performance-Issues
  - **Status**: In Bearbeitung
  - **Workaround**: Tempor√§re L√∂sung verf√ºgbar

## üìÑ Lizenz

Dieses Projekt ist unter der [MIT License](LICENSE) lizensiert - siehe [LICENSE](LICENSE) Datei f√ºr Details.

## üë®‚Äçüíª Autor

**Diede** - *Initial work* - [ddumdi11](https://github.com/ddumdi11)

### üõ†Ô∏è Entwickelt mit Unterst√ºtzung von:
- [Claude Code](https://claude.ai/code) - KI-gest√ºtzter Entwicklungsassistent

## üôè Danksagungen

- Claude Code Team f√ºr die innovative Entwicklungsunterst√ºtzung
- Open Source Community

---

‚≠ê **Gef√§llt dir das Projekt?** Gib ihm einen Stern und folge mir f√ºr weitere innovative Entwicklungen!

üìß **Kontakt**: ***@*** (auf Anfrage) | üíº **LinkedIn**: https://www.linkedin.com/in/thorsten-diederichs-a05051203/
